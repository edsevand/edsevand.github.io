<!doctype html><html><head><title>Construcción del modelo</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href=/google-fonts/Mulish/mulish.css><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png><meta property="og:title" content="Construcción del modelo"><meta property="og:description" content="Modelo de regresión lineal Simple"><meta property="og:type" content="article"><meta property="og:url" content="https://edsevand.github.io/posts/linreg/linreg/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-28T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-28T00:00:00+00:00"><meta name=description content="Modelo de regresión lineal Simple"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_3.png alt=Logo>
Eduardo's Portfolio</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20>
</a><a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20>
</a><a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20></a></div></li></ul></div></div><img src=/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/linreg/>Regresión Lineal</a><ul class=active><li><a class=active href=/posts/linreg/linreg/ title="Regresión Lineal Simple">Regresión Lineal Simple</a></li><li><a href=/posts/linreg/outliers/ title=Outliers>Outliers</a></li><li><a href=/posts/linreg/linregm/ title="Regresión Lineal Múltiple">Regresión Lineal Múltiple</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/clustering/>Clustering</a><ul><li><a href=/posts/clustering/clustering1/ title=Introducción>Introducción</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/tree/>Árboles y Bosques</a><ul><li><a href=/posts/tree/tree1/ title=Introducción>Introducción</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/indicadores/>Power BI</a><ul><li><a href=/posts/indicadores/ind1/ title="Aplicación real">Aplicación real</a></li><li><a href=/posts/indicadores/ind2/ title="Base de datos">Base de datos</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/lalo_hubb05f1fdda3ef8b4e61e9b342ed2e904_625036_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name>Eduardo Sevilla</h5><p>Friday, October 28, 2022</p></div><div class=title><h1>Construcción del modelo</h1></div><div class=post-content id=post-content><h1 id=p-aligncentercuántas-veces-se-comparte-un-artículop><p align=center>¿Cuántas veces se comparte un artículo?</p></h1><p align=justify>A continuación se presenta un ejercicio en el que se muestra un dataset con datos de diversos
artículos que se utilizan para construir un modelo que permita predecir cuantas veces se comparte en función de
estas variables seleccionadas de acuerdo con la <strong>correlación</strong> de los datos.</p><hr><h2 id=pasos-iniciales>Pasos iniciales</h2><p align=justify>Se importan las siguientes librerías:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> statsmodels.formula.api <span style=color:#66d9ef>as</span> smf
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> statsmodels.api <span style=color:#66d9ef>as</span> sm
</span></span></code></pre></div><blockquote><p align=justify>La librería <strong>statsmodel.formula.api</strong> permite crear y entrenar el modelo lineal.</p></blockquote><p align=justify>Se carga el dataset por medio de la librería pandas para tener un panorama general de los datos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;../articulos_ml.csv&#34;</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><p><div style=margin-top:1rem></div><figure><img src=/posts/images/linreg/dataset.png></figure></p><p align=justify>Solo se toman en cuenta las columnas con variables númericas las cuales se pueden utilizar para
construir el modelo, sin embargo, también se observan valores faltantes "NaN" que tienen que ser reemplazados
por un valor que se crea conveniente.</p><p align=justify>Con funciones como <strong>info()</strong> y <strong>describe()</strong> se obtiene la cantidad de
datos por columna, el tipo de datos de cada una, así como estadísticas más relevantes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df<span style=color:#f92672>.</span>describe()
</span></span></code></pre></div><p><div style=margin-top:1rem></div><figure><img src=/posts/images/linreg/describe.png></figure></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df<span style=color:#f92672>.</span>info()
</span></span></code></pre></div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 161 entries, 0 to 160
Data columns (total 8 columns):
 #   Column          Non-Null Count  Dtype  
---  ------          --------------  -----  
 0   Title           161 non-null    object 
 1   url             122 non-null    object 
 2   Word count      161 non-null    int64  
 3   # of Links      161 non-null    int64  
 4   # of comments   129 non-null    float64
 5   # Images video  161 non-null    int64  
 6   Elapsed days    161 non-null    int64  
 7   # Shares        161 non-null    int64  
dtypes: float64(1), int64(5), object(2)
memory usage: 10.2+ KB
</code></pre><blockquote><p align=justify>Destacar la cantidad total de datos faltantes "NaN" en la columna "# of comments".</p></blockquote><h3 id=correlación-de-los-datos>Correlación de los datos</h3><p align=justify>Conocer como se correlacionan las variables (columnas) del dataset es un punto de partida excelente,
y permite seleccionar las mejores variables para un mejor modelo. La siguiente línea de código muestra un cuadro
de correlación con su escala correpondiente.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>corr <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>corr()
</span></span><span style=display:flex><span>sm<span style=color:#f92672>.</span>graphics<span style=color:#f92672>.</span>plot_corr(corr, xnames<span style=color:#f92672>=</span>list(corr<span style=color:#f92672>.</span>columns))
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><p><div style=margin-top:1rem></div><figure><img src=/posts/images/linreg/correlacion.png></figure></p><blockquote><p align=justify>Solo toman sentido aquellas correlaciones que sean mayores a 0.6 en la escala que se muestra, de otra manera, el modelo a construir no será buen predictor.</p></blockquote><p align=justify>La correlación entre las variables no es buena con ningún par de variables, con lo que con toda
probabilidad el modelo a construir no tendra una buena eficacia. De cualquier manera se óptara por seleccionar el mejor
par y se intentarán diferentes técnicas para mejorar el modelo.</p><p align=justify>El análisis anterior arroja distintas consideraciones:<ul><li>Renombrar las distintas columnas del dataset de una manera más práctica y evitar errores al construir el modelo</li><li>Reemplazar valores NaN en columna &ldquo;# of comments&rdquo;</li><li>Crear distintos modelos de acuerdo a los mejores pares de variables de acuerdo con la escala de correlación:<ul><li>Shares~Links</li><li>Shares~Comments</li></ul></li><li>Posibilidad de mejorar el modelo aplicando regresión múltiple y eliminando outliers</li></ul></p><hr><h2 id=data-wrangling>Data wrangling</h2><p align=justify>Primeramente, se procede a renombrar las columnas del dataset, debido a que existen espacios en
los nombres y para la librería causa conflicto. La siguiente línea de código lo muestra.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>new <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;Word count&#39;</span>: <span style=color:#e6db74>&#34;Word_count&#34;</span>, <span style=color:#e6db74>&#39;# of Links&#39;</span>: <span style=color:#e6db74>&#34;Links&#34;</span>, <span style=color:#e6db74>&#39;# of comments&#39;</span>: <span style=color:#e6db74>&#34;Comments&#34;</span>, <span style=color:#e6db74>&#39;# Images video&#39;</span>: <span style=color:#e6db74>&#34;Images_video&#34;</span>, <span style=color:#e6db74>&#39;# Shares&#39;</span>: <span style=color:#e6db74>&#34;Shares&#34;</span>}
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span> new)
</span></span></code></pre></div><p align=justify>Se llenan los valores faltantes (NaN) en ciertas filas del dataset, especificamente de
la columna "Comments" y se opta por hacerlo con la función fillna() con valores 0.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#e6db74>&#34;Comments&#34;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#34;Comments&#34;</span>]<span style=color:#f92672>.</span>fillna(<span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><blockquote><p align=justify>El data wrangling siempre puede variar dependiendo de las decisiones que se tomen y por ende, el resultado final.</p></blockquote><hr><h2 id=construcción-del-modelo>Construcción del modelo</h2><p align=justify>Para la construcción del modelo se utiliza una función que crea el modelo y devuelve el resultado
con las estadísticas a tener en cuenta para verificar la eficiencia del modelo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>linreg</span>(df, x, y):
</span></span><span style=display:flex><span>    lm <span style=color:#f92672>=</span> smf<span style=color:#f92672>.</span>ols(formula <span style=color:#f92672>=</span> y <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;~&#34;</span> <span style=color:#f92672>+</span> x, data <span style=color:#f92672>=</span> df)<span style=color:#f92672>.</span>fit()
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#34;Ventas_&#34;</span> <span style=color:#f92672>+</span> x] <span style=color:#f92672>=</span> lm<span style=color:#f92672>.</span>predict(pd<span style=color:#f92672>.</span>DataFrame(df[x]))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>     SSD <span style=color:#f92672>=</span> sum((df[y] <span style=color:#f92672>-</span> df[<span style=color:#e6db74>&#34;Ventas_&#34;</span> <span style=color:#f92672>+</span> x])<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>) <span style=color:#75715e>#Suma de los cuadrados de la diferencia.</span>
</span></span><span style=display:flex><span>     RSE <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>sqrt(SSD<span style=color:#f92672>/</span>(len(df)<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>)) <span style=color:#75715e>#Error estándar de los residuos.</span>
</span></span><span style=display:flex><span>    mean <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>mean(df[y])
</span></span><span style=display:flex><span>    error <span style=color:#f92672>=</span> RSE<span style=color:#f92672>/</span>mean <span style=color:#75715e>#Cantidad en % que el modelo deja de explicar.</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({<span style=color:#e6db74>&#34;Params&#34;</span>: lm<span style=color:#f92672>.</span>params, <span style=color:#e6db74>&#34;Pvalues&#34;</span>: lm<span style=color:#f92672>.</span>pvalues})
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    p <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({<span style=color:#e6db74>&#34;Rsquared&#34;</span>: lm<span style=color:#f92672>.</span>rsquared_adj, <span style=color:#e6db74>&#34;SSD&#34;</span>: SSD, <span style=color:#e6db74>&#34;RSE&#34;</span>: RSE, <span style=color:#e6db74>&#34;Error&#34;</span>: error}, index<span style=color:#f92672>=</span>[x])
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#f92672>%</span>matplotlib inline
</span></span><span style=display:flex><span>    df<span style=color:#f92672>.</span>plot(kind<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;scatter&#34;</span>, x <span style=color:#f92672>=</span> x, y <span style=color:#f92672>=</span> y)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>plot(df[x], df[<span style=color:#e6db74>&#34;Ventas_&#34;</span><span style=color:#f92672>+</span> x], c <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;red&#34;</span>, linewidth <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    print(r)
</span></span><span style=display:flex><span>    print(p)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (r, p)
</span></span></code></pre></div><div style=margin-top:2rem></div><p>En primera instancia se utiliza el par <strong>Shares~Comments</strong> para construir el modelo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rscomments, pscomments <span style=color:#f92672>=</span> linreg(df, <span style=color:#e6db74>&#34;Comments&#34;</span>, <span style=color:#e6db74>&#34;Shares&#34;</span>)
</span></span></code></pre></div><pre><code>                 Params       Pvalues
Intercept  21232.276623  1.067793e-07
Comments     954.357867  5.389726e-04
          Rsquared           SSD           RSE     Error
Comments   0.06694  2.795417e+11  41929.987171  1.500267
</code></pre><div style=margin-top:2rem></div><p>Con el par <strong>Shares~Links</strong> se obtiene.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rswordc, pswordc <span style=color:#f92672>=</span> linreg(df, <span style=color:#e6db74>&#34;Links&#34;</span>, <span style=color:#e6db74>&#34;Shares&#34;</span>)
</span></span></code></pre></div><pre><code>                 Params       Pvalues
Intercept  25369.818622  3.005289e-12
Links        264.759695  2.080691e-04
       Rsquared           SSD           RSE     Error
Links  0.077365  2.764183e+11  41695.081094  1.491862
</code></pre><div style=margin-top:2rem></div><p align=justify>Ambos casos arrojan modelos deficientes, con una eficacia muy pequeña y un %Error realmente alto.
Estos resultados eran evidentes en la escala de correlación, ya que ninguno alcanzaba el 0.6. Queda la
posibilidad de tratar de mejorar los modelos si se eliminan los <strong>outliers</strong> y se aplica una
<strong>regresión múltiple</strong></p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div></div><hr><div class="row next-prev-navigator"><div class="col-md-12 next-article"><a href=/posts/linreg/outliers/ title=Outliers class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Outliers</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#pasos-iniciales>Pasos iniciales</a><ul><li><a href=#correlación-de-los-datos>Correlación de los datos</a></li></ul></li><li><a href=#data-wrangling>Data wrangling</a></li><li><a href=#construcción-del-modelo>Construcción del modelo</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://edsevand.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://edsevand.github.io/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://edsevand.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://edsevand.github.io/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://edsevand.github.io/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:edsevand@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>edsevand@gmail.com</span></a></li><li><span><i class="fas fa-phone-alt"></i></span> <span>+52 4772330230</span></li><li><a href=https://github.com/edsevand target=_blank rel=noopener><span><i class="fab fa-fab fa-github"></i></span> <span>Eduardo Sevilla</span></a></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form method=post action=https://blogtrottr.com><div class=form-group><input type=email class=form-control name=btr_email placeholder="Enter email"><br><input type=hidden name=btr_url value=https://edsevand.github.io/index.xml>
<input type=hidden name=schedule_type value=1>
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small>
<button type=submit class="btn btn-info"> Submit</button></div></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script type=text/javascript src=/js/darkreader.js></script><script type=text/javascript src=/js/darkmode-darkreader.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>